# Health Metrics LLM Prototype

A Python project that uses Ultrahuman ring-like health data to detect anomalies and generate LLM-powered explanations for health metric patterns.

## Phase 1 Overview

This is **Phase 1** of the Health Metrics LLM Prototype project. The current implementation focuses on:

- Fetching health metrics data from the UltraHuman API
- Detecting anomalies using rolling baseline comparisons
- Generating natural language explanations using Azure OpenAI
- Storing enriched data locally in Parquet format

## Architecture (Phase 1)

The current architecture follows this data flow:

```
UltraHuman API → pandas DataFrame → Anomaly Detection → Azure OpenAI → Parquet Output
```

**Components:**
- **UltraHuman Client** (`src/ultrahuman_client.py`): Fetches health metrics from the UltraHuman Partner API
- **Anomaly Detection** (`src/anomaly_detection.py`): Detects anomalies using 7-day rolling medians and threshold-based flags
- **LLM Explainer** (`src/llm_explainer.py`): Generates explanations using Azure OpenAI
- **Pipeline** (`src/pipeline.py`): Orchestrates the entire flow
- **CLI Entrypoint** (`src/run_pipeline.py`): Command-line interface for running the pipeline

## Requirements

- Python 3.10+

## Setup Instructions

### 1. Create Virtual Environment

```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

### 2. Install Dependencies

```bash
pip install -r requirements.txt
```

### 3. Configure Environment Variables

Create a `.env` file in the project root (copy from `.env.example`):

```bash
cp .env.example .env
```

Set the following environment variables:

```env
# UltraHuman API Configuration
ULTRAHUMAN_API_BASE_URL=https://partner.ultrahuman.com
ULTRAHUMAN_API_KEY=your_api_key_here
ULTRAHUMAN_EMAIL=your_email@example.com

# Azure OpenAI Configuration
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com
AZURE_OPENAI_API_KEY=your_azure_openai_key
AZURE_OPENAI_DEPLOYMENT=gpt-4o-mini

# Local Storage Configuration
LOCAL_DATA_DIR=data
```

### 4. Run the Pipeline

```bash
python -m src.run_pipeline
```

This will:
- Fetch the last 14 days of health metrics
- Detect anomalies
- Generate an LLM explanation for recent anomalies
- Save enriched data to `data/daily_metrics_enriched.parquet`
- Print results to the console

## Project Structure

```
health-metrics-llm-prototype/
├── src/
│   ├── __init__.py
│   ├── config.py              # Configuration management
│   ├── ultrahuman_client.py   # UltraHuman API client
│   ├── anomaly_detection.py   # Anomaly detection logic
│   ├── llm_explainer.py       # Azure OpenAI integration
│   ├── pipeline.py            # Main pipeline orchestration
│   └── run_pipeline.py        # CLI entrypoint
├── data/
│   ├── .gitkeep
│   └── sample_ultrahuman_export.json  # Sample data for testing
├── notebooks/
│   └── 01_explore_ultrahuman_data.ipynb
├── .env.example               # Environment variable template
├── .gitignore
├── requirements.txt
└── README.md
```

## Future Phases

Future phases of this project will add:

- **Azure Data Lake**: For scalable data storage
- **Azure Data Explorer**: For advanced analytics and querying
- **Azure Cache for Redis**: For caching and performance optimization
- **FastAPI Backend**: RESTful API for serving health insights
- **React Web App**: User interface for viewing health metrics and explanations

## Important Disclaimer

⚠️ **This is NOT a medical device and does NOT provide medical advice.**

This project is for informational and educational purposes only. The health metrics analysis and explanations generated by this system are not intended to:

- Diagnose, treat, cure, or prevent any disease or medical condition
- Replace professional medical advice, diagnosis, or treatment
- Be used as a substitute for consultation with qualified healthcare professionals

**Always consult with a qualified healthcare professional** for any health concerns or before making decisions about your health based on information from this system.

## License

TBD
